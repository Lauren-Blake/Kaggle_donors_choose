---
title: "Sentiment in XGBoost"
author: "Lauren Blake"
date: 2018-04-22
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

# Introduction

The goal of this script is to run XGBoost on a model which includes information about the essays.

```{r}
# Libraries

library(dplyr)
library(stringr)
library(tidytext)
library(ggplot2)
library(tidyverse)
library("xgboost")


# Open the datasets

train <- read.csv("~/Dropbox/DonorsChoose/train.csv")
test <- read.csv("~/Dropbox/DonorsChoose/test.csv")
resources <- read.csv("~/Dropbox/DonorsChoose/resources.csv")

```

# Get the number of words in the title


```{r}
# First, we want to select project id, title name, and if the project was approved or not

id_title <- c(1, 16, 9)

train_text <- train[,id_title]
train_text[,1] <- as.character(train_text[,1])
train_text[,2] <- as.numeric(train_text[,2])
train_text[,3] <- as.character(train_text[,3])

train_text <- as.tibble(train_text)

tidy_books <- train_text %>% unnest_tokens(word, project_title)

# Take out stop (common) words

tidy_books <- tidy_books %>%
  anti_join(stop_words)

freq_table <- count(tidy_books, id) 

title_word_count_by_project <- left_join(freq_table, train_text[,1:2], by = c("id"))

title_word_count_by_project <- as.data.frame(title_word_count_by_project)

```

# Function for minimium and median 

```{r}

get_min_med <- function(name_of_tibble){
# Get minimium and median
janeaustensentiment <- tidy_books %>% inner_join(get_sentiments("afinn"))

check_min <- aggregate(janeaustensentiment$score, by = list(janeaustensentiment$id), FUN = min)
colnames(check_min) <- c("id", "min_score")

check_med <- aggregate(janeaustensentiment$score, by = list(janeaustensentiment$id), FUN = median)
colnames(check_med) <- c("id", "med_score")

check_corr_titles <- cbind(check_min$id, check_min$min_score, check_med$med_score)
colnames(check_corr_titles) <- c("id", "min_score", "med_score")

check_corr_titles <- as.data.frame(check_corr_titles)
}

min_med_title <- get_min_med(tidy_books)

```


# Get number of words in essay 1

```{r}
# First, we want to select project id, title name, and if the project was approved or not

id_title <- c(1, 16, 10)

train_text <- train[,id_title]
train_text[,1] <- as.character(train_text[,1])
train_text[,2] <- as.numeric(train_text[,2])
train_text[,3] <- as.character(train_text[,3])

train_text <- as.tibble(train_text)

tidy_books <- train_text %>% unnest_tokens(word, project_essay_1)

# Find how many words in essay1

freq_table <- count(tidy_books, id) 

essay1_word_count_by_project <- left_join(freq_table, train_text[,1:2], by = c("id"))

# Take out stop (common) words

tidy_books <- tidy_books %>%
  anti_join(stop_words)

freq_table <- count(tidy_books, id) 

essay1_word_count_by_project <- left_join(freq_table, train_text[,1:2], by = c("id"))

essay1_word_count_by_project <- as.data.frame(essay1_word_count_by_project)

min_med_essay1 <- get_min_med(tidy_books)
```

# Get number of words in essay 2

```{r}
# First, we want to select project id, title name, and if the project was approved or not

id_title <- c(1, 16, 11)

train_text <- train[,id_title]
train_text[,1] <- as.character(train_text[,1])
train_text[,2] <- as.numeric(train_text[,2])
train_text[,3] <- as.character(train_text[,3])

train_text <- as.tibble(train_text)

tidy_books <- train_text %>% unnest_tokens(word, project_essay_2)

# Find how many words in essay1

freq_table <- count(tidy_books, id) 

essay2_word_count_by_project <- left_join(freq_table, train_text[,1:2], by = c("id"))

# Take out stop (common) words

tidy_books <- tidy_books %>%
  anti_join(stop_words)

freq_table <- count(tidy_books, id) 

essay2_word_count_by_project <- left_join(freq_table, train_text[,1:2], by = c("id"))

essay2_word_count_by_project <- as.data.frame(essay2_word_count_by_project)

min_med_essay2 <- get_min_med(tidy_books)
```

# Combine information

```{r}
text_info <- cbind(title_word_count_by_project$id, title_word_count_by_project$n, min_med_title$min_score, min_med_title$med_score, essay1_word_count_by_project$n, min_med_essay1$min_score, min_med_essay1$med_score, essay2_word_count_by_project$n, min_med_essay2$min_score, min_med_essay2$med_score)

head(text_info)
```



## Session information

<!-- Insert the session information into the document -->
```{r session-info}
```
